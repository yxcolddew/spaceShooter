
# -------------------------------------------------------------------------------------------------
# random(x)
#   returns a random integer in the range [0, x - 1]
#   so random(100) will return numbers [0, 99]
random:
	move a1, a0
	li   a0, 0
	syscall_rand_range
	jr ra

# -------------------------------------------------------------------------------------------------
# (fixed24_8, fixed24_8) to_cartesian(fixed24_8 r, int theta)
#   converts a polar coordinate/vector (r, theta) to cartesian coordinate (x, y).
#   returns x in v0, y in v1.
#   uses convention of theta=0 is up (negative Y on display), clockwise as angle increases
to_cartesian:
	# gets unscaled vector 16.16 from theta
	# (same as sin_cos code)
	add t1, a1, 90
	rem a1, a1, 360
	rem t1, t1, 360
	la  t0, sin_table
	sll a1, a1, 2
	sll t1, t1, 2
	add v0, t0, a1
	lw  v0, (v0)
	add v1, t0, t1
	lw  v1, (v1)

	# multiply by r
	mul v0, v0, a0
	neg a0, a0 # flip y axis
	mul v1, v1, a0

	# now they're 8.24. shift right to 24.8
	sra v0, v0, 16
	sra v1, v1, 16

	jr ra

.data
sin_table: .word
	0x00000000 0x00000477 0x000008EF 0x00000D65 0x000011DB 0x0000164F
	0x00001AC2 0x00001F32 0x000023A0 0x0000280C 0x00002C74 0x000030D8
	0x00003539 0x00003996 0x00003DEE 0x00004241 0x00004690 0x00004AD8
	0x00004F1B 0x00005358 0x0000578E 0x00005BBE 0x00005FE6 0x00006406
	0x0000681F 0x00006C30 0x00007039 0x00007438 0x0000782F 0x00007C1C
	0x00007FFF 0x000083D9 0x000087A8 0x00008B6D 0x00008F27 0x000092D5
	0x00009679 0x00009A10 0x00009D9B 0x0000A11B 0x0000A48D 0x0000A7F3
	0x0000AB4C 0x0000AE97 0x0000B1D5 0x0000B504 0x0000B826 0x0000BB39
	0x0000BE3E 0x0000C134 0x0000C41B 0x0000C6F3 0x0000C9BB 0x0000CC73
	0x0000CF1B 0x0000D1B3 0x0000D43B 0x0000D6B3 0x0000D919 0x0000DB6F
	0x0000DDB3 0x0000DFE7 0x0000E208 0x0000E419 0x0000E617 0x0000E803
	0x0000E9DE 0x0000EBA6 0x0000ED5B 0x0000EEFF 0x0000F08F 0x0000F20D
	0x0000F378 0x0000F4D0 0x0000F615 0x0000F746 0x0000F865 0x0000F970
	0x0000FA67 0x0000FB4B 0x0000FC1C 0x0000FCD9 0x0000FD82 0x0000FE17
	0x0000FE98 0x0000FF06 0x0000FF60 0x0000FFA6 0x0000FFD8 0x0000FFF6
	0x00010000 0x0000FFF6 0x0000FFD8 0x0000FFA6 0x0000FF60 0x0000FF06
	0x0000FE98 0x0000FE17 0x0000FD82 0x0000FCD9 0x0000FC1C 0x0000FB4B
	0x0000FA67 0x0000F970 0x0000F865 0x0000F746 0x0000F615 0x0000F4D0
	0x0000F378 0x0000F20D 0x0000F08F 0x0000EEFF 0x0000ED5B 0x0000EBA6
	0x0000E9DE 0x0000E803 0x0000E617 0x0000E419 0x0000E208 0x0000DFE7
	0x0000DDB3 0x0000DB6F 0x0000D919 0x0000D6B3 0x0000D43B 0x0000D1B3
	0x0000CF1B 0x0000CC73 0x0000C9BB 0x0000C6F3 0x0000C41B 0x0000C134
	0x0000BE3E 0x0000BB39 0x0000B826 0x0000B504 0x0000B1D5 0x0000AE97
	0x0000AB4C 0x0000A7F3 0x0000A48D 0x0000A11B 0x00009D9B 0x00009A10
	0x00009679 0x000092D5 0x00008F27 0x00008B6D 0x000087A8 0x000083D9
	0x00007FFF 0x00007C1C 0x0000782F 0x00007438 0x00007039 0x00006C30
	0x0000681F 0x00006406 0x00005FE6 0x00005BBE 0x0000578E 0x00005358
	0x00004F1B 0x00004AD8 0x00004690 0x00004241 0x00003DEE 0x00003996
	0x00003539 0x000030D8 0x00002C74 0x0000280C 0x000023A0 0x00001F32
	0x00001AC2 0x0000164F 0x000011DB 0x00000D65 0x000008EF 0x00000477
	0x00000000 0xFFFFFB89 0xFFFFF711 0xFFFFF29B 0xFFFFEE25 0xFFFFE9B1
	0xFFFFE53E 0xFFFFE0CE 0xFFFFDC60 0xFFFFD7F4 0xFFFFD38C 0xFFFFCF28
	0xFFFFCAC7 0xFFFFC66A 0xFFFFC212 0xFFFFBDBF 0xFFFFB970 0xFFFFB528
	0xFFFFB0E5 0xFFFFACA8 0xFFFFA872 0xFFFFA442 0xFFFFA01A 0xFFFF9BFA
	0xFFFF97E1 0xFFFF93D0 0xFFFF8FC7 0xFFFF8BC8 0xFFFF87D1 0xFFFF83E4
	0xFFFF8000 0xFFFF7C27 0xFFFF7858 0xFFFF7493 0xFFFF70D9 0xFFFF6D2B
	0xFFFF6987 0xFFFF65F0 0xFFFF6265 0xFFFF5EE5 0xFFFF5B73 0xFFFF580D
	0xFFFF54B4 0xFFFF5169 0xFFFF4E2B 0xFFFF4AFC 0xFFFF47DA 0xFFFF44C7
	0xFFFF41C2 0xFFFF3ECC 0xFFFF3BE5 0xFFFF390D 0xFFFF3645 0xFFFF338D
	0xFFFF30E5 0xFFFF2E4D 0xFFFF2BC5 0xFFFF294D 0xFFFF26E7 0xFFFF2491
	0xFFFF224D 0xFFFF2019 0xFFFF1DF8 0xFFFF1BE7 0xFFFF19E9 0xFFFF17FD
	0xFFFF1622 0xFFFF145A 0xFFFF12A5 0xFFFF1101 0xFFFF0F71 0xFFFF0DF3
	0xFFFF0C88 0xFFFF0B30 0xFFFF09EB 0xFFFF08BA 0xFFFF079B 0xFFFF0690
	0xFFFF0599 0xFFFF04B5 0xFFFF03E4 0xFFFF0327 0xFFFF027E 0xFFFF01E9
	0xFFFF0168 0xFFFF00FA 0xFFFF00A0 0xFFFF005A 0xFFFF0028 0xFFFF000A
	0xFFFF0000 0xFFFF000A 0xFFFF0028 0xFFFF005A 0xFFFF00A0 0xFFFF00FA
	0xFFFF0168 0xFFFF01E9 0xFFFF027E 0xFFFF0327 0xFFFF03E4 0xFFFF04B5
	0xFFFF0599 0xFFFF0690 0xFFFF079B 0xFFFF08BA 0xFFFF09EB 0xFFFF0B30
	0xFFFF0C88 0xFFFF0DF3 0xFFFF0F71 0xFFFF1101 0xFFFF12A5 0xFFFF145A
	0xFFFF1622 0xFFFF17FD 0xFFFF19E9 0xFFFF1BE7 0xFFFF1DF8 0xFFFF2019
	0xFFFF224D 0xFFFF2491 0xFFFF26E7 0xFFFF294D 0xFFFF2BC5 0xFFFF2E4D
	0xFFFF30E5 0xFFFF338D 0xFFFF3645 0xFFFF390D 0xFFFF3BE5 0xFFFF3ECC
	0xFFFF41C2 0xFFFF44C7 0xFFFF47DA 0xFFFF4AFC 0xFFFF4E2B 0xFFFF5169
	0xFFFF54B4 0xFFFF580D 0xFFFF5B73 0xFFFF5EE5 0xFFFF6265 0xFFFF65F0
	0xFFFF6987 0xFFFF6D2B 0xFFFF70D9 0xFFFF7493 0xFFFF7858 0xFFFF7C27
	0xFFFF8000 0xFFFF83E4 0xFFFF87D1 0xFFFF8BC8 0xFFFF8FC7 0xFFFF93D0
	0xFFFF97E1 0xFFFF9BFA 0xFFFFA01A 0xFFFFA442 0xFFFFA872 0xFFFFACA8
	0xFFFFB0E5 0xFFFFB528 0xFFFFB970 0xFFFFBDBF 0xFFFFC212 0xFFFFC66A
	0xFFFFCAC7 0xFFFFCF28 0xFFFFD38C 0xFFFFD7F4 0xFFFFDC60 0xFFFFE0CE
	0xFFFFE53E 0xFFFFE9B1 0xFFFFEE25 0xFFFFF29B 0xFFFFF711 0xFFFFFB89
.text